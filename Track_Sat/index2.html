<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Starlink Earth Tracker</title>

  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/satellite.js/4.1.4/satellite.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      font-family: 'Arial', sans-serif;
      background: #000;
    }
    
    #container {
      position: relative;
      width: 100%;
      height: 100%;
    }
    
    #controls {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 100;
      background: rgba(0, 0, 0, 0.8);
      padding: 20px;
      border-radius: 10px;
      color: white;
      min-width: 250px;
    }
    
    #controls h3 {
      margin: 0 0 15px 0;
      color: #00ff88;
    }
    
    .control-group {
      margin-bottom: 15px;
    }
    
    .control-group label {
      display: block;
      margin-bottom: 5px;
      font-size: 12px;
      color: #ccc;
    }
    
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px 5px 5px 0;
      font-size: 12px;
      transition: all 0.3s ease;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    button.active {
      background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
    }
    
    #stats {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 100;
      background: rgba(0, 0, 0, 0.8);
      padding: 15px;
      border-radius: 10px;
      color: white;
      font-size: 12px;
      min-width: 200px;
    }
    
    .stat-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .stat-value {
      color: #00ff88;
      font-weight: bold;
    }
    
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 18px;
      z-index: 1000;
    }
    
    .spinner {
      border: 3px solid #333;
      border-top: 3px solid #00ff88;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="loading">
      <div class="spinner"></div>
      Loading Earth and Starlink data...
    </div>
    
    <div id="controls">
      <h3>üõ∞Ô∏è Starlink Tracker</h3>
      
      <div class="control-group">
        <button id="toggleStarlink" class="active">Show Starlink</button>
        <button id="toggleOrbits">Show Orbits</button>
        <button id="toggleLabels">Show Labels</button>
      </div>
      
      <div class="control-group">
        <label>Satellite Size:</label>
        <button onclick="setSatelliteSize(0.5)">Small</button>
        <button onclick="setSatelliteSize(1)" class="active">Medium</button>
        <button onclick="setSatelliteSize(2)">Large</button>
      </div>
      
      <div class="control-group">
        <button onclick="focusOnStarlink()">Focus Constellation</button>
        <button onclick="resetView()">Reset View</button>
      </div>
    </div>
    
    <div id="stats">
      <h4 style="margin: 0 0 10px 0; color: #00ff88;">Live Stats</h4>
      <div class="stat-item">
        <span>Active Satellites:</span>
        <span class="stat-value" id="activeSats">0</span>
      </div>
      <div class="stat-item">
        <span>Avg Altitude:</span>
        <span class="stat-value" id="avgAlt">0 km</span>
      </div>
      <div class="stat-item">
        <span>Coverage:</span>
        <span class="stat-value" id="coverage">0%</span>
      </div>
      <div class="stat-item">
        <span>Update Rate:</span>
        <span class="stat-value">Real-time</span>
      </div>
    </div>
  </div>

  <script>
    let scene, camera, renderer, earth, earthGroup;
    let satellites = [];
    let starlinkVisible = true;
    let orbitsVisible = false;
    let labelsVisible = false;
    let satelliteSize = 1;
    
    const EARTH_RADIUS = 100;
    const SCALE_FACTOR = 0.01; // Scale for satellite positions
    
    // Mock Starlink data (in real app, fetch from API)
    const mockStarlinkData = generateMockStarlink(100);
    
    function generateMockStarlink(count) {
      const satellites = [];
      for (let i = 0; i < count; i++) {
        // Starlink satellites orbit at ~550km altitude
        const altitude = 550 + Math.random() * 100; // km
        const inclination = 53 + Math.random() * 10; // degrees
        const longitude = Math.random() * 360 - 180;
        const latitude = (Math.random() - 0.5) * 160; // More spread
        
        satellites.push({
          id: `STARLINK-${i + 1}`,
          name: `Starlink ${i + 1}`,
          latitude: latitude,
          longitude: longitude,
          altitude: altitude,
          velocity: 7.5 + Math.random() * 0.5, // km/s
          status: Math.random() > 0.05 ? 'active' : 'inactive'
        });
      }
      return satellites;
    }
    
    function init() {
      // Scene setup
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x000008);
      
      // Camera
      camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 5000);
      camera.position.set(0, 0, 300);
      camera.lookAt(0, 0, 0);
      
      // Renderer
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      document.getElementById('container').appendChild(renderer.domElement);
      
      // Lighting
      const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
      scene.add(ambientLight);
      
      const sunLight = new THREE.DirectionalLight(0xffffff, 1);
      sunLight.position.set(500, 200, 500);
      sunLight.castShadow = true;
      sunLight.shadow.mapSize.width = 2048;
      sunLight.shadow.mapSize.height = 2048;
      scene.add(sunLight);
      
      // Stars background
      createStarField();
      
      // Earth
      createEarth();
      
      // Starlink satellites
      createStarlinkSatellites();
      
      // Controls
      setupControls();
      
      // Hide loading
      document.getElementById('loading').style.display = 'none';
      
      // Start animation
      animate();
    }
    
    function createStarField() {
      const starsGeometry = new THREE.BufferGeometry();
      const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 1 });
      
      const starsVertices = [];
      for (let i = 0; i < 1000; i++) {
        const radius = 2000;
        const x = (Math.random() - 0.5) * radius * 2;
        const y = (Math.random() - 0.5) * radius * 2;
        const z = (Math.random() - 0.5) * radius * 2;
        starsVertices.push(x, y, z);
      }
      
      starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
      const stars = new THREE.Points(starsGeometry, starsMaterial);
      scene.add(stars);
    }
    
    function createEarth() {
      earthGroup = new THREE.Group();
      const earthGeometry = new THREE.SphereGeometry(EARTH_RADIUS, 64, 64);

      // Load earth.jpg as texture
      const textureLoader = new THREE.TextureLoader();
      textureLoader.load('earth.jpg', function(earthTexture) {
        const earthMaterial = new THREE.MeshPhongMaterial({
          map: earthTexture,
          shininess: 30,
          specular: 0x222222
        });

        earth = new THREE.Mesh(earthGeometry, earthMaterial);
        earth.receiveShadow = true;
        earthGroup.add(earth);

        // Atmosphere
        const atmosphereGeometry = new THREE.SphereGeometry(EARTH_RADIUS * 1.05, 32, 32);
        const atmosphereMaterial = new THREE.ShaderMaterial({
          vertexShader: `
            varying vec3 vNormal;
            void main() {
              vNormal = normalize(normalMatrix * normal);
              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
          `,
          fragmentShader: `
            varying vec3 vNormal;
            void main() {
              float intensity = pow(0.7 - dot(vNormal, vec3(0, 0, 1.0)), 2.0);
              gl_FragColor = vec4(0.3, 0.6, 1.0, 1.0) * intensity;
            }
          `,
          blending: THREE.AdditiveBlending,
          side: THREE.BackSide,
          transparent: true
        });
        const atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
        earthGroup.add(atmosphere);

        // Add grid lines
        const gridMaterial = new THREE.LineBasicMaterial({ 
          color: 0x444444, 
          transparent: true, 
          opacity: 0.3 
        });
        for (let lat = -80; lat <= 80; lat += 20) {
          const latGeometry = new THREE.RingGeometry(
            EARTH_RADIUS * Math.cos(lat * Math.PI / 180), 
            EARTH_RADIUS * Math.cos(lat * Math.PI / 180) + 0.1, 
            32
          );
          const latLine = new THREE.Line(latGeometry, gridMaterial);
          latLine.position.y = EARTH_RADIUS * Math.sin(lat * Math.PI / 180);
          latLine.rotation.x = Math.PI / 2;
          earthGroup.add(latLine);
        }

        scene.add(earthGroup);
      });
    }
    
    function createStarlinkSatellites() {
      mockStarlinkData.forEach((satData, index) => {
        const satellite = createSatellite(satData);
        satellites.push(satellite);
        scene.add(satellite.group);
      });
      
      updateStats();
    }
    
    function createSatellite(satData) {
      const group = new THREE.Group();
      
      // Simple dot representation
      const dotGeometry = new THREE.SphereGeometry(1.5 * satelliteSize, 8, 6);
      const dotMaterial = new THREE.MeshBasicMaterial({ 
        color: satData.status === 'active' ? 0x00ff88 : 0xff4444,
        transparent: true,
        opacity: 0.9
      });
      const dot = new THREE.Mesh(dotGeometry, dotMaterial);
      group.add(dot);
      
      // Small glow effect
      const glowGeometry = new THREE.SphereGeometry(2.5 * satelliteSize, 8, 6);
      const glowMaterial = new THREE.MeshBasicMaterial({
        color: satData.status === 'active' ? 0x00ff88 : 0xff4444,
        transparent: true,
        opacity: 0.15
      });
      const glow = new THREE.Mesh(glowGeometry, glowMaterial);
      group.add(glow);
      
      // Position satellite
      const position = latLonToPosition(satData.latitude, satData.longitude, satData.altitude);
      group.position.copy(position);
      
      return {
        group: group,
        data: satData,
        dot: dot,
        glow: glow
      };
    }
    
    function latLonToPosition(lat, lon, alt) {
      const phi = (90 - lat) * Math.PI / 180;
      const theta = (lon + 180) * Math.PI / 180;
      const radius = EARTH_RADIUS + (alt * SCALE_FACTOR * 2); // Increased scale for visibility
      
      const x = radius * Math.sin(phi) * Math.cos(theta);
      const z = radius * Math.sin(phi) * Math.sin(theta);
      const y = radius * Math.cos(phi);
      
      return new THREE.Vector3(x, y, z);
    }
    
    function setupControls() {
      document.getElementById('toggleStarlink').onclick = () => {
        starlinkVisible = !starlinkVisible;
        satellites.forEach(sat => {
          sat.group.visible = starlinkVisible;
        });
        document.getElementById('toggleStarlink').classList.toggle('active');
      };
      
      document.getElementById('toggleOrbits').onclick = () => {
        orbitsVisible = !orbitsVisible;
        // Add orbit visualization logic here
        document.getElementById('toggleOrbits').classList.toggle('active');
      };
      
      document.getElementById('toggleLabels').onclick = () => {
        labelsVisible = !labelsVisible;
        // Add label visualization logic here
        document.getElementById('toggleLabels').classList.toggle('active');
      };
      
      // Mouse controls
      let mouseDown = false;
      let mouseX = 0;
      let mouseY = 0;
      
      renderer.domElement.addEventListener('mousedown', (event) => {
        mouseDown = true;
        mouseX = event.clientX;
        mouseY = event.clientY;
      });
      
      renderer.domElement.addEventListener('mouseup', () => {
        mouseDown = false;
      });
      
      renderer.domElement.addEventListener('mousemove', (event) => {
        if (!mouseDown) return;
        
        const deltaX = event.clientX - mouseX;
        const deltaY = event.clientY - mouseY;
        
        earthGroup.rotation.y += deltaX * 0.01;
        earthGroup.rotation.x += deltaY * 0.01;
        
        mouseX = event.clientX;
        mouseY = event.clientY;
      });
      
      // Zoom
      renderer.domElement.addEventListener('wheel', (event) => {
        const zoomSpeed = 10;
        camera.position.multiplyScalar(1 + event.deltaY * 0.001 * zoomSpeed);
        camera.position.clampLength(150, 1000);
      });
    }
    
    function setSatelliteSize(size) {
      satelliteSize = size;
      // Update existing satellites
      satellites.forEach(sat => {
        sat.group.scale.setScalar(size);
      });
      
      // Update active button
      document.querySelectorAll('#controls button').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
    }
    
    function focusOnStarlink() {
      // Animate camera to show all Starlink satellites
      camera.position.set(400, 300, 400);
      camera.lookAt(0, 0, 0);
    }
    
    function resetView() {
      camera.position.set(300, 200, 300);
      camera.lookAt(0, 0, 0);
      earthGroup.rotation.set(0, 0, 0);
    }
    
    function updateStats() {
      const activeSats = satellites.filter(sat => sat.data.status === 'active').length;
      const avgAlt = satellites.reduce((sum, sat) => sum + sat.data.altitude, 0) / satellites.length;
      const coverage = Math.min(95, (activeSats / 1000) * 100); // Rough estimate
      
      document.getElementById('activeSats').textContent = activeSats;
      document.getElementById('avgAlt').textContent = Math.round(avgAlt) + ' km';
      document.getElementById('coverage').textContent = Math.round(coverage) + '%';
    }
    
    function animate() {
      requestAnimationFrame(animate);
      
      // Rotate Earth slowly
      if (earthGroup) {
        earthGroup.rotation.y += 0.0005; // Much slower rotation
      }
      
      // Animate satellites (very subtle orbital motion)
      satellites.forEach((sat, index) => {
        if (sat.group.visible) {
          // Very slow, smooth orbital animation
          const time = Date.now() * 0.00001; // 10x slower
          const speed = sat.data.velocity * 0.01; // Much slower movement
          
          // Gentle orbital motion around Earth
          const orbitAxis = new THREE.Vector3(
            Math.sin(index * 0.1), // Slight variation per satellite
            1,
            Math.cos(index * 0.1)
          ).normalize();
          
          const currentPos = sat.group.position.clone();
          const angle = speed * time * 0.1; // Very slow
          currentPos.applyAxisAngle(orbitAxis, angle);
          
          // Keep satellites at proper distance from Earth
          currentPos.normalize().multiplyScalar(EARTH_RADIUS + (sat.data.altitude * SCALE_FACTOR * 2));
          sat.group.position.copy(currentPos);
          
          // Subtle glow pulse for active satellites
          if (sat.data.status === 'active') {
            sat.glow.material.opacity = 0.1 + 0.05 * Math.sin(time * 2 + index);
          }
        }
      });
      
      renderer.render(scene, camera);
    }
    
    // Handle window resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
    
    // Initialize when page loads
    init();
    
    // API Integration functions (uncomment and modify when ready to use real APIs)
    /*
    async function fetchStarlinkData() {
      try {
        // Example using N2YO API
        const response = await fetch('https://api.n2yo.com/rest/v1/satellite/above/41.702/-76.014/0/70/18/&apiKey=YOUR_API_KEY');
        const data = await response.json();
        return data.above;
      } catch (error) {
        console.error('Error fetching Starlink data:', error);
        return mockStarlinkData; // Fallback to mock data
      }
    }
    
    async function fetchTLEData() {
      try {
        // Example using Space-Track.org
        const response = await fetch('https://www.space-track.org/basicspacedata/query/class/tle_latest/ORDINAL/1/OBJECT_NAME/STARLINK~~/format/json');
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Error fetching TLE data:', error);
        return null;
      }
    }
    */
  </script>
</body>
</html>