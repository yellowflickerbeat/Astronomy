<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Starlink Earth Tracker</title>

  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/satellite.js/4.1.4/satellite.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      font-family: 'Arial', sans-serif;
      background: #000;
    }
    
    #container {
      position: relative;
      width: 100%;
      height: 100%;
    }
    
    #controls {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 100;
      background: rgba(0, 0, 0, 0.8);
      padding: 20px;
      border-radius: 10px;
      color: white;
      min-width: 250px;
    }
    
    #controls h3 {
      margin: 0 0 15px 0;
      color: #00ff88;
    }
    
    .control-group {
      margin-bottom: 15px;
    }
    
    .control-group label {
      display: block;
      margin-bottom: 5px;
      font-size: 12px;
      color: #ccc;
    }
    
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px 5px 5px 0;
      font-size: 12px;
      transition: all 0.3s ease;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    button.active {
      background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
    }
    
    #stats {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 100;
      background: rgba(0, 0, 0, 0.8);
      padding: 15px;
      border-radius: 10px;
      color: white;
      font-size: 12px;
      min-width: 200px;
    }
    
    .stat-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .stat-value {
      color: #00ff88;
      font-weight: bold;
    }

    #legend {
      position: absolute;
      bottom: 360px;
      right: 20px;
      z-index: 100;
      background: rgba(0, 0, 0, 0.8);
      padding: 15px;
      border-radius: 10px;
      color: white;
      font-size: 12px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .legend-dot.active {
      background: #00ff88;
    }

    .legend-dot.inactive {
      background: #ff4444;
    }

    #satelliteList {
      position: absolute;
      left: 20px;
      bottom: 50px;
      width: 280px;
      max-height: 400px;
      background: rgba(0, 0, 0, 0.9);
      border-radius: 10px;
      color: white;
      font-size: 11px;
      z-index: 100;
      overflow-y: auto;
      display: none;
    }

    #satelliteList h4 {
      margin: 0;
      padding: 15px;
      color: #00ff88;
      border-bottom: 1px solid #333;
    }

    .satellite-item {
      padding: 8px 15px;
      border-bottom: 1px solid #222;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
    }

    .satellite-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .satellite-item.selected {
      background: rgba(0, 255, 136, 0.2);
    }

    .satellite-status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
      flex-shrink: 0;
    }

    .satellite-status-dot.active {
      background: #00ff88;
    }

    .satellite-status-dot.inactive {
      background: #ff4444;
    }

    #satelliteDetails {
      position: absolute;
      right: 20px;
      bottom: 20px;
      width: 250px;
      background: rgba(0, 0, 0, 0.9);
      border-radius: 10px;
      color: white;
      font-size: 12px;
      z-index: 100;
      display: none;
      padding: 15px;
    }

    #satelliteDetails h4 {
      margin: 0 0 10px 0;
      color: #00ff88;
    }

    .detail-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      padding: 4px 0;
      border-bottom: 1px solid #333;
    }

    .detail-value {
      color: #00ff88;
      font-weight: bold;
    }
    
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 18px;
      z-index: 1000;
    }
    
    .spinner {
      border: 3px solid #333;
      border-top: 3px solid #00ff88;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .satellite-label {
      position: absolute;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      pointer-events: none;
      z-index: 50;
      white-space: nowrap;
      border: 1px solid #00ff88;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="loading">
      <div class="spinner"></div>
      Loading Earth and Starlink data...
    </div>
    
    <div id="controls">
      <h3>üõ∞Ô∏è Starlink Tracker</h3>
      
      <div class="control-group">
        <button id="toggleStarlink" class="active">Show Starlink</button>
        <button id="toggleOrbits">Show Orbits</button>
        <button id="toggleLabels">Show Labels</button>
        <button id="toggleTrails">Show Trails</button>
      </div>
      
      <div class="control-group">
        <label>Satellite Size:</label>
        <button onclick="setSatelliteSize(0.5)">Small</button>
        <button onclick="setSatelliteSize(1)" class="active">Medium</button>
        <button onclick="setSatelliteSize(2)">Large</button>
      </div>
      
      <div class="control-group">
        <button onclick="focusOnStarlink()">Focus Constellation</button>
        <button onclick="resetView()">Reset View</button>
      </div>
    </div>
    
    <div id="stats">
      <h4 style="margin: 0 0 10px 0; color: #00ff88;">Live Stats</h4>
      <div class="stat-item">
        <span>Active Satellites:</span>
        <span class="stat-value" id="activeSats">0</span>
      </div>
      <div class="stat-item">
        <span>Avg Altitude:</span>
        <span class="stat-value" id="avgAlt">0 km</span>
      </div>
      <div class="stat-item">
        <span>Coverage:</span>
        <span class="stat-value" id="coverage">0%</span>
      </div>
      <div class="stat-item">
        <span>Update Rate:</span>
        <span class="stat-value">Real-time</span>
      </div>
    </div>

    <div id="satelliteList">
      <h4>üõ∞Ô∏è Satellite List</h4>
      <div id="satelliteListContent"></div>
    </div>

    <div id="satelliteDetails">
      <h4>üì° Satellite Details</h4>
      <div id="satelliteDetailsContent">
        <p>Click on a satellite to view details</p>
      </div>
    </div>

    <div id="legend">
      <h4 style="margin: 0 0 10px 0; color: #00ff88;">Legend</h4>
      <div class="legend-item">
        <div class="legend-dot active"></div>
        <span>Active Satellite</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot inactive"></div>
        <span>Inactive Satellite</span>
      </div>
    </div>
  </div>

  <script>
    let scene, camera, renderer, earth, earthGroup;
    let satellites = [];
    let orbitPaths = [];
    let satelliteTrails = [];
    let raycaster, mouse;
    let selectedSatellite = null;
    let starlinkVisible = true;
    let orbitsVisible = false;
    let labelsVisible = false;
    let trailsVisible = false;
    let satelliteSize = 1;
    
    const EARTH_RADIUS = 100;
    const SCALE_FACTOR = 0.01;
    const TRAIL_LENGTH = 20;
    
    // Mock Starlink data
    const mockStarlinkData = generateMockStarlink(100);
    
    function generateMockStarlink(count) {
      const satellites = [];
      for (let i = 0; i < count; i++) {
        const altitude = 550 + Math.random() * 100;
        const inclination = 53 + Math.random() * 10;
        const longitude = Math.random() * 360 - 180;
        const latitude = (Math.random() - 0.5) * 160;
        
        satellites.push({
          id: `STARLINK-${i + 1}`,
          name: `Starlink ${i + 1}`,
          latitude: latitude,
          longitude: longitude,
          altitude: altitude,
          velocity: 7.5 + Math.random() * 0.5,
          status: Math.random() > 0.05 ? 'active' : 'inactive',
          inclination: inclination
        });
      }
      return satellites;
    }
    
    function init() {
      // Scene setup
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x000008);
      
      // Camera
      camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 5000);
      camera.position.set(0, 0, 300);
      camera.lookAt(0, 0, 0);
      
      // Renderer
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      document.getElementById('container').appendChild(renderer.domElement);
      
      // Raycaster for mouse picking
      raycaster = new THREE.Raycaster();
      mouse = new THREE.Vector2();
      
      // Lighting
      const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
      scene.add(ambientLight);
      
      const sunLight = new THREE.DirectionalLight(0xffffff, 1);
      sunLight.position.set(500, 200, 500);
      sunLight.castShadow = true;
      sunLight.shadow.mapSize.width = 2048;
      sunLight.shadow.mapSize.height = 2048;
      scene.add(sunLight);
      
      // Stars background
      createStarField();
      
      // Earth
      createEarth();
      
      // Starlink satellites
      createStarlinkSatellites();
      
      // Orbit paths
      createOrbitPaths();
      
      // Controls
      setupControls();
      
      // Populate satellite list
      populateSatelliteList();
      
      // Hide loading
      document.getElementById('loading').style.display = 'none';
      
      // Start animation
      animate();
    }
    
    function createStarField() {
      const starsGeometry = new THREE.BufferGeometry();
      const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 1 });
      
      const starsVertices = [];
      for (let i = 0; i < 1000; i++) {
        const radius = 2000;
        const x = (Math.random() - 0.5) * radius * 2;
        const y = (Math.random() - 0.5) * radius * 2;
        const z = (Math.random() - 0.5) * radius * 2;
        starsVertices.push(x, y, z);
      }
      
      starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
      const stars = new THREE.Points(starsGeometry, starsMaterial);
      scene.add(stars);
    }
    
    function createEarth() {
      earthGroup = new THREE.Group();
      const earthGeometry = new THREE.SphereGeometry(EARTH_RADIUS, 64, 64);

      // Load earth.jpg as texture (must be equirectangular projection)
      const textureLoader = new THREE.TextureLoader();
      textureLoader.load('earth.jpg', function(earthTexture) {
        const earthMaterial = new THREE.MeshPhongMaterial({
          map: earthTexture,
          shininess: 30,
          specular: 0x222222
        });

        earth = new THREE.Mesh(earthGeometry, earthMaterial);
        earth.receiveShadow = true;
        earthGroup.add(earth);

        // Atmosphere
        const atmosphereGeometry = new THREE.SphereGeometry(EARTH_RADIUS * 1.05, 32, 32);
        const atmosphereMaterial = new THREE.ShaderMaterial({
          vertexShader: `
            varying vec3 vNormal;
            void main() {
              vNormal = normalize(normalMatrix * normal);
              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
          `,
          fragmentShader: `
            varying vec3 vNormal;
            void main() {
              float intensity = pow(0.7 - dot(vNormal, vec3(0, 0, 1.0)), 2.0);
              gl_FragColor = vec4(0.3, 0.6, 1.0, 1.0) * intensity;
            }
          `,
          blending: THREE.AdditiveBlending,
          side: THREE.BackSide,
          transparent: true
        });
        const atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
        earthGroup.add(atmosphere);

        scene.add(earthGroup);
      });
    }
    
    function createOrbitPaths() {
      mockStarlinkData.forEach((satData, index) => {
        const orbitGroup = new THREE.Group();
        
        // Create orbital path
        const orbitGeometry = new THREE.BufferGeometry();
        const orbitPoints = [];
        const segments = 64;
        const radius = EARTH_RADIUS + (satData.altitude * SCALE_FACTOR * 2);
        
        for (let i = 0; i <= segments; i++) {
          const angle = (i / segments) * Math.PI * 2;
          const x = radius * Math.cos(angle);
          const y = 0;
          const z = radius * Math.sin(angle);
          orbitPoints.push(x, y, z);
        }
        
        orbitGeometry.setAttribute('position', new THREE.Float32BufferAttribute(orbitPoints, 3));
        
        const orbitMaterial = new THREE.LineBasicMaterial({
          color: satData.status === 'active' ? 0x00ff88 : 0xff4444,
          transparent: true,
          opacity: 0.2
        });
        
        const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
        
        // Rotate orbit based on inclination
        orbitLine.rotation.x = satData.inclination * Math.PI / 180;
        orbitLine.rotation.y = Math.random() * Math.PI * 2; // Random rotation around Y axis
        
        orbitGroup.add(orbitLine);
        orbitGroup.visible = orbitsVisible;
        
        orbitPaths.push(orbitGroup);
        scene.add(orbitGroup);
      });
    }
    
    function createStarlinkSatellites() {
      mockStarlinkData.forEach((satData, index) => {
        const satellite = createSatellite(satData, index);
        satellites.push(satellite);
        scene.add(satellite.group);
        
        // Create trail for this satellite
        const trail = createSatelliteTrail(satData);
        satelliteTrails.push(trail);
        scene.add(trail.group);
      });
      
      updateStats();
    }
    
    function createSatellite(satData, index) {
      const group = new THREE.Group();
      
      // Simple dot representation
      const dotGeometry = new THREE.SphereGeometry(1.5 * satelliteSize, 8, 6);
      const dotMaterial = new THREE.MeshBasicMaterial({ 
        color: satData.status === 'active' ? 0x00ff88 : 0xff4444,
        transparent: true,
        opacity: 0.9
      });
      const dot = new THREE.Mesh(dotGeometry, dotMaterial);
      group.add(dot);
      
      // Small glow effect
      const glowGeometry = new THREE.SphereGeometry(2.5 * satelliteSize, 8, 6);
      const glowMaterial = new THREE.MeshBasicMaterial({
        color: satData.status === 'active' ? 0x00ff88 : 0xff4444,
        transparent: true,
        opacity: 0.15
      });
      const glow = new THREE.Mesh(glowGeometry, glowMaterial);
      group.add(glow);
      
      // Position satellite
      const position = latLonToPosition(satData.latitude, satData.longitude, satData.altitude);
      group.position.copy(position);
      
      return {
        group: group,
        data: satData,
        dot: dot,
        glow: glow,
        index: index
      };
    }
    
    function createSatelliteTrail(satData) {
      const group = new THREE.Group();
      const trailPoints = [];
      
      // Initialize trail with current position
      const currentPos = latLonToPosition(satData.latitude, satData.longitude, satData.altitude);
      for (let i = 0; i < TRAIL_LENGTH; i++) {
        trailPoints.push(currentPos.clone());
      }
      
      const trailGeometry = new THREE.BufferGeometry();
      const positions = [];
      const colors = [];
      
      trailPoints.forEach((point, i) => {
        positions.push(point.x, point.y, point.z);
        const alpha = i / TRAIL_LENGTH;
        const color = satData.status === 'active' ? 
          new THREE.Color(0x00ff88) : new THREE.Color(0xff4444);
        colors.push(color.r, color.g, color.b);
      });
      
      trailGeometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
      trailGeometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
      
      const trailMaterial = new THREE.LineBasicMaterial({
        vertexColors: true,
        transparent: true,
        opacity: 0.6
      });
      
      const trailLine = new THREE.Line(trailGeometry, trailMaterial);
      group.add(trailLine);
      group.visible = trailsVisible;
      
      return {
        group: group,
        points: trailPoints,
        geometry: trailGeometry,
        line: trailLine
      };
    }
    
    function populateSatelliteList() {
      const listContent = document.getElementById('satelliteListContent');
      listContent.innerHTML = '';
      
      mockStarlinkData.forEach((satData, index) => {
        const item = document.createElement('div');
        item.className = 'satellite-item';
        item.dataset.index = index;
        
        const statusDot = document.createElement('div');
        statusDot.className = `satellite-status-dot ${satData.status}`;
        
        const nameSpan = document.createElement('span');
        nameSpan.textContent = satData.name;
        
        item.appendChild(statusDot);
        item.appendChild(nameSpan);
        
        item.addEventListener('click', () => selectSatellite(index));
        
        listContent.appendChild(item);
      });
    }
    
    function selectSatellite(index) {
      // Clear previous selection
      document.querySelectorAll('.satellite-item').forEach(item => {
        item.classList.remove('selected');
      });
      
      // Highlight selected item
      const selectedItem = document.querySelector(`[data-index="${index}"]`);
      if (selectedItem) {
        selectedItem.classList.add('selected');
      }
      
      selectedSatellite = satellites[index];
      showSatelliteDetails(satellites[index].data);
      
      // Highlight satellite in 3D scene
      highlightSatellite(index);
    }
    
    function showSatelliteDetails(satData) {
      const detailsContent = document.getElementById('satelliteDetailsContent');
      detailsContent.innerHTML = `
        <div class="detail-item">
          <span>Name:</span>
          <span class="detail-value">${satData.name}</span>
        </div>
        <div class="detail-item">
          <span>Status:</span>
          <span class="detail-value">${satData.status.toUpperCase()}</span>
        </div>
        <div class="detail-item">
          <span>Altitude:</span>
          <span class="detail-value">${satData.altitude.toFixed(1)} km</span>
        </div>
        <div class="detail-item">
          <span>Inclination:</span>
          <span class="detail-value">${satData.inclination.toFixed(1)}¬∞</span>
        </div>
        <div class="detail-item">
          <span>Velocity:</span>
          <span class="detail-value">${satData.velocity.toFixed(2)} km/s</span>
        </div>
        <div class="detail-item">
          <span>Latitude:</span>
          <span class="detail-value">${satData.latitude.toFixed(2)}¬∞</span>
        </div>
        <div class="detail-item">
          <span>Longitude:</span>
          <span class="detail-value">${satData.longitude.toFixed(2)}¬∞</span>
        </div>
      `;
      
      document.getElementById('satelliteDetails').style.display = 'block';
    }
    
    function highlightSatellite(index) {
      // Reset all satellites to normal appearance
      satellites.forEach((sat, i) => {
        if (i === index) {
          // Highlight selected satellite
          sat.dot.material.emissive.setHex(0x444444);
          sat.glow.material.opacity = 0.4;
        } else {
          // Dim other satellites
          sat.dot.material.emissive.setHex(0x000000);
          sat.glow.material.opacity = 0.15;
        }
      });
    }
    
    function onMouseClick(event) {
      // Calculate mouse position in normalized device coordinates
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
      
      // Update the picking ray with the camera and mouse position
      raycaster.setFromCamera(mouse, camera);
      
      // Calculate objects intersecting the picking ray
      const clickableObjects = satellites.map(sat => sat.dot);
      const intersects = raycaster.intersectObjects(clickableObjects);
      
      if (intersects.length > 0) {
        // Find which satellite was clicked
        const clickedObject = intersects[0].object;
        const satelliteIndex = satellites.findIndex(sat => sat.dot === clickedObject);
        
        if (satelliteIndex !== -1) {
          selectSatellite(satelliteIndex);
        }
      }
    }
    
    function updateTrails() {
      satelliteTrails.forEach((trail, index) => {
        if (!trailsVisible || !satellites[index]) return;
        
        const satellite = satellites[index];
        const currentPos = satellite.group.position.clone();
        
        // Add current position to trail
        trail.points.push(currentPos);
        if (trail.points.length > TRAIL_LENGTH) {
          trail.points.shift();
        }
        
        // Update trail geometry
        const positions = [];
        trail.points.forEach(point => {
          positions.push(point.x, point.y, point.z);
        });
        
        trail.geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
        trail.geometry.attributes.position.needsUpdate = true;
      });
    }
    
    function latLonToPosition(lat, lon, alt) {
      const phi = (90 - lat) * Math.PI / 180;
      const theta = (lon + 180) * Math.PI / 180;
      const radius = EARTH_RADIUS + (alt * SCALE_FACTOR * 2);
      
      const x = radius * Math.sin(phi) * Math.cos(theta);
      const z = radius * Math.sin(phi) * Math.sin(theta);
      const y = radius * Math.cos(phi);
      
      return new THREE.Vector3(x, y, z);
    }
    
    function setupControls() {
      document.getElementById('toggleStarlink').onclick = () => {
        starlinkVisible = !starlinkVisible;
        satellites.forEach(sat => {
          sat.group.visible = starlinkVisible;
        });
        document.getElementById('toggleStarlink').classList.toggle('active');
      };
      
      document.getElementById('toggleOrbits').onclick = () => {
        orbitsVisible = !orbitsVisible;
        orbitPaths.forEach(orbit => {
          orbit.visible = orbitsVisible;
        });
        document.getElementById('toggleOrbits').classList.toggle('active');
      };
      
      document.getElementById('toggleLabels').onclick = () => {
        labelsVisible = !labelsVisible;
        const satelliteList = document.getElementById('satelliteList');
        satelliteList.style.display = labelsVisible ? 'block' : 'none';
        document.getElementById('toggleLabels').classList.toggle('active');
      };
      
      document.getElementById('toggleTrails').onclick = () => {
        trailsVisible = !trailsVisible;
        satelliteTrails.forEach(trail => {
          trail.group.visible = trailsVisible;
        });
        document.getElementById('toggleTrails').classList.toggle('active');
      };
      
      // Mouse click for satellite selection
      renderer.domElement.addEventListener('click', onMouseClick);
      
      // Mouse controls
      let mouseDown = false;
      let mouseX = 0;
      let mouseY = 0;
      
      renderer.domElement.addEventListener('mousedown', (event) => {
        mouseDown = true;
        mouseX = event.clientX;
        mouseY = event.clientY;
      });
      
      renderer.domElement.addEventListener('mouseup', () => {
        mouseDown = false;
      });
      
      renderer.domElement.addEventListener('mousemove', (event) => {
        if (!mouseDown) return;
        
        const deltaX = event.clientX - mouseX;
        const deltaY = event.clientY - mouseY;
        
        earthGroup.rotation.y += deltaX * 0.01;
        earthGroup.rotation.x += deltaY * 0.01;
        
        mouseX = event.clientX;
        mouseY = event.clientY;
      });
      
      // Zoom
      renderer.domElement.addEventListener('wheel', (event) => {
        const zoomSpeed = 10;
        camera.position.multiplyScalar(1 + event.deltaY * 0.001 * zoomSpeed);
        camera.position.clampLength(150, 1000);
      });
    }
    
    function setSatelliteSize(size) {
      satelliteSize = size;
      satellites.forEach(sat => {
        sat.group.scale.setScalar(size);
      });
      
      document.querySelectorAll('#controls button').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
    }
    
    function focusOnStarlink() {
      camera.position.set(400, 300, 400);
      camera.lookAt(0, 0, 0);
    }
    
    function resetView() {
      camera.position.set(300, 200, 300);
      camera.lookAt(0, 0, 0);
      earthGroup.rotation.set(0, 0, 0);
    }
    
    function updateStats() {
      const activeSats = satellites.filter(sat => sat.data.status === 'active').length;
      const avgAlt = satellites.reduce((sum, sat) => sum + sat.data.altitude, 0) / satellites.length;
      const coverage = Math.min(95, (activeSats / 1000) * 100);
      
      document.getElementById('activeSats').textContent = activeSats;
      document.getElementById('avgAlt').textContent = Math.round(avgAlt) + ' km';
      document.getElementById('coverage').textContent = Math.round(coverage) + '%';
    }
    
    function animate() {
      requestAnimationFrame(animate);
      
      // Rotate Earth slowly
      if (earthGroup) {
        earthGroup.rotation.y += 0.0005;
      }
      
      // Animate satellites
      satellites.forEach((sat, index) => {
        if (sat.group.visible) {
          const time = Date.now() * 0.00001;
          const speed = sat.data.velocity * 0.01;
          
          const orbitAxis = new THREE.Vector3(
            Math.sin(index * 0.1),
            1,
            Math.cos(index * 0.1)
          ).normalize();
          
          const currentPos = sat.group.position.clone();
          const angle = speed * time * 0.1;
          currentPos.applyAxisAngle(orbitAxis, angle);
          
          currentPos.normalize().multiplyScalar(EARTH_RADIUS + (sat.data.altitude * SCALE_FACTOR * 2));
          sat.group.position.copy(currentPos);
          
          if (sat.data.status === 'active') {
            sat.glow.material.opacity = 0.1 + 0.05 * Math.sin(time * 2 + index);
          }
        }
      });
      
      // Update trails
      updateTrails();
      
      renderer.render(scene, camera);
    }
    
    // Handle window resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
    
    // Initialize when page loads
    init();
  </script>
</body>
</html>
